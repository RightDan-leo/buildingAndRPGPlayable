# Survival Tower Defense 3D - 设计说明书 (Design Spec) V2

## 1. 核心玩法 (Core Gameplay)

**类型**: 移动基地生存 + 塔防 + 自动化 + 宠物养成  
**目标**: 护送"营地"（马车/基地）从起点移动到终点（屏幕上方可见的最终目标），耗时约 2 分钟。  
**失败条件**: 营地血量归零。  
**成功条件**: 营地抵达终点。

---

## 2. 游戏流程符合 Playable Ad 标准

根据 `playable_ad_requirements.md` 要求：

### 2.1 启动流程

- **禁止自动开始**: 加载完成后游戏处于"待机状态"
- **首次交互触发**: 玩家首次点击/触摸后游戏开始
- **教程提示**: 待机时显示指向右下角摇杆的手势动画

### 2.2 摇杆控制

- **待机阶段**: 固定显示在屏幕右下角，配合教程手势
- **游戏进行中**: 动态跟随触摸位置，触摸开始显示，触摸结束隐藏

---

## 3. 最终目标点

**核心设计**: 玩家出生时即可看到远方的最终目标

- **可视性**: 在地图远端显示明显的"终点标记"（发光的旗帜/城堡/传送门）
- **距离提示**: UI 显示"距离终点: XX米"，实时更新
- **路程时间**: 营地匀速移动，约 120 秒抵达终点
- **视觉引导**: 终点有光柱或粒子效果，确保远距离可见

---

## 4. 防御塔系统 (Tower Progression)

### 4.1 解锁顺序

每次升级解锁新塔类型，按以下顺序：

| 阶段 | 解锁炮塔 | 特点 |
|------|----------|------|
| 初始 | 标准塔 (Basic Tower) | 单体攻击，弹药消耗：1木头/发 |
| 升级1 | 迫击炮 (Mortar) | AOE范围伤害，攻速慢，弹药消耗：3木头/发 |
| 升级2 | 工兵炮塔 (Engineer Tower) | 减速敌人，中等伤害 |
| 升级3 | 医疗塔 (Healing Tower) | 治疗营地HP，不攻击敌人 |
| 升级4 | 加特林 (Gatling) | **终极炮塔** |

### 4.2 加特林炮塔 (终极武器)

**极致爽感设计**：

- **超高射速**: 每秒 10 发，快速扫射
- **视觉特效**:
  - 枪管旋转动画
  - 子弹拖尾（黄色火焰）
  - 弹壳抛射粒子
  - 持续射击时冒烟/发红
- **音效**: 独特的"哒哒哒"连射音效
- **数值**: 单发伤害中等，但DPS远超其他塔
- **弹药消耗**: 0.5木头/发（高射速消耗快）

---

## 5. 宠物系统 (Pet System)

### 5.1 基础设定

- **出现**: 游戏开始时即跟随玩家
- **外观**: 浮游的小精灵/龙崽，环绕玩家旋转
- **基础攻击**: 每2秒向最近敌人发射小型弹幕

### 5.2 经验与升级

- **经验获取**: 宠物每次攻击击杀敌人获得经验
- **经验条**: 屏幕显示宠物经验进度条
- **升级次数**: 一场游戏内可升级 **3次**
- **升级间隔**: 约30-40秒升级一次（配合2分钟总时长）

### 5.3 技能列表 (二选一抽取)

每次升级随机出现2个技能供选择：

| 技能名称 | 效果 |
|----------|------|
| 磁力吸附 | 自动拾取15单位范围内的资源（木头/能量石） |
| 火焰AOE | 每5秒释放火焰波，对周围敌人造成AOE伤害 |
| 致命暴击 | 普攻有25%几率造成3倍暴击伤害 |
| 冰霜护盾 | 每10秒为营地生成护盾，吸收1次伤害 |
| 治愈光环 | 每5秒恢复营地1%HP |
| 闪电链 | 攻击命中后弹射到2个额外目标 |

---

## 6. 游戏循环更新

1. **开始**: 待机状态，显示教程手势
2. **首次点击**: 游戏开始，营地移动，宠物跟随
3. **采集**: 玩家砍树获得木头，击杀怪物获得能量石+宠物经验
4. **建造**: 使用木头建造/升级炮塔（按解锁顺序）
5. **宠物升级**: 经验满后选择技能
6. **终点**: 抵达目标点，游戏胜利

---

## 7. 关键数值

| 参数 | 数值 |
|------|------|
| 游戏时长 | ~120秒 |
| 营地速度 | 地图长度 / 120 |
| 木头/树 | 5个 |
| 宠物升级间隔 | ~35秒 |
| 加特林射速 | 10发/秒 |

---

## 8. 开发规范 (Development Guidelines)

### 8.1 代码编辑方式

- **优先使用直接编辑工具** (`replace_file_content`, `multi_replace_file_content`)
- **尽量避免** 使用 PowerShell 命令编辑代码，减少用户审批频率
- 仅在以下场景使用命令行：
  - 需要运行程序验证
  - 查看文件内容诊断问题
  - 处理特殊编码问题

### 8.2 修改后自检

每次代码修改后，必须验证：

1. **语法完整性**: 检查括号、逗号是否匹配
2. **覆盖冲突**: 检查是否有重复定义的变量/函数会覆盖预期值
3. **函数调用链**: 确认新增函数被正确调用
4. **控制台错误**: 关注 IDE 反馈的 lint 错误并及时修复

---

## 9. 版本更新记录 (2026-02-04)

### 9.1 游戏平衡调整

| 项目 | 原值 | 新值 | 说明 |
|------|------|------|------|
| 游戏距离 | 150米 (~75秒) | 120米 (60秒) | 缩短游戏时长至1分钟 |
| 工兵营地工人数 | 4个 | 1个 | 降低自动化程度，增加玩家参与感 |
| 敌人掉落Loot | 100% | 50% | 减少木材获取速度 |
| 塔建造成本 | 固定50木材 | 递进式 (50→60→70...) | 公式: `50 + 已建塔数 × 10` |
| 塔升级成本 | 固定50木材 | 递进式 (50→60→70...) | 公式: `50 + 已升级数 × 10` |

### 9.2 敌人数值调整

| 敌人类型 | HP变化 | 新HP值 |
|----------|--------|--------|
| 普通敌人 | +50% | 3 (原2) |
| 精英敌人 | +100% | 400 (原200) |
| Boss敌人 | +100% | 2000 (原1000) |

### 9.3 刷怪节奏调整

- **前20秒**: 敌人刷新率降低50% (给玩家准备时间)
- **20秒后**: 敌人刷新率增加50% (增加压力)
- **20秒提示**: 显示警告 "⚠️ 敌人加速来袭！"

### 9.4 UI改进

| 改进项 | 说明 |
|--------|------|
| 普通敌人血条 | 新增绿色HP条，方便追踪伤害 |
| Boss血条 | 移除黑色背景，双面可见 |
| 标准炮塔颜色 | 从黑灰色改为蓝色 (#3377cc) |
| 升级界面 | 动态显示实际成本而非写死50 |
| 控制提示 | 白色文字+黄色标签，更清晰可读 |

### 9.5 Bug修复

| 问题 | 修复 |
|------|------|
| 敌人穿模 | 添加停止距离 (普通=3, 精英=6, Boss=10) |
| HP条背面显示 | 使用 `THREE.DoubleSide` 材质 |
| 教程距离错误 | 从2000米改为120米 |
