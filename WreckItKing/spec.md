# 🐉 游戏开发文档：无敌破坏王

**版本号**: 1.0 (Release Candidate)  
**类型**: 3D 俯视角 / 模拟经营 / 塔防 / Roguelike  
**平台**: H5 (移动端 Web / PC 浏览器)  
**核心技术**: Three.js (渲染), Nipple.js (摇杆), Web Audio API (程序化音效)

---

## 1. 游戏概述 (Game Overview)

### 核心玩法

玩家控制英雄在开放地图中通过破坏环境（砍树/挖矿）获取资源，利用资源在基地内建造和升级设施（箭塔、兵营、工人房），抵御不断来袭的黑暗军团，最终击败巨型 BOSS 取得胜利。

### 游戏循环

采集资源 ➔ 升级建筑/角色 ➔ 提升战斗力 ➔ 抵御更强敌潮 ➔ 击杀 BOSS ➔ 胜利转化

---

## 2. 核心机制 (Core Mechanics)

### 2.1 操控系统

**移动：**

- 移动端：屏幕左下角固定位置虚拟摇杆（Joystick）
- PC端：键盘 WASD 或 方向键

**交互：**

- 采集：靠近树木/岩石自动挥动武器采集
- 升级：走进地面的发光光圈（Upgrade Zone）自动消耗资源进行升级
- 战斗：全自动攻击。主角/宠物/士兵/箭塔会自动索敌

### 2.2 资源系统

**单一资源**：木石 (📦)

**获取途径**：

- 主角破坏环境物体（树木、岩石）
- 工人自动采集并运回
- 击杀敌人掉落（基础掉落值：20）

---

## 3. 单位与角色 (Entities)

### 3.1 主角 (Player)

- **外观**：蓝色方块人
- **属性**：血量极厚（10000 HP），带有绿色血条
- **武器**：初期普通斧头，升级后获得冰霜巨斧（采集一击必杀）

### 3.2 宠物 (Dragon)

- **外观**：紫色悬浮球体（带翅膀）
- **行为**：跟随玩家，自动攻击范围内敌人
- **升级**：Lv2 后变色并具备更强的攻击力

### 3.3 友方单位

| 单位名称 | 外观颜色 | 攻击方式 | 行为逻辑 |
|---------|---------|---------|---------|
| 工人 (Worker) | 青色 | 无 | 自动寻找最近资源 -> 采集 -> 背负资源 -> 返回基地中心交付 -> 循环 |
| 士兵 (Soldier) | 亮绿色 | 远程射击 (能量枪) | 守家AI：在营地半径+5米范围内巡逻索敌；优先攻击未被锁定的敌人；BOSS出现时全员集火BOSS |

### 3.4 敌对单位

| 单位名称 | 外观 | 属性 | 行为逻辑 |
|---------|-----|------|---------|
| 黑暗军团 | 红色方块 | 速度快 (0.24) | 自动寻路至玩家或城墙；被城墙阻挡时攻击城墙；死亡时产生碎裂物理效果 |
| BOSS | 巨型红色 | 10000 HP / 速度极快 (0.26) | 购买终极塔后3秒生成；出生在主城门口 (35米处)；无视一切阻挡直冲基地中心 |

---

## 4. 建筑与升级流程 (Progression & Upgrades)

游戏采用线性解锁机制，玩家必须按顺序完成以下升级：

| 顺序 | 升级项目 | 消耗资源 | 效果描述 | 附带环境变化 |
|-----|---------|---------|---------|-------------|
| 1 | 强化精灵龙 | 40 | 宠物进化，攻击力提升 | - |
| 2 | 冰霜巨斧 | 100 | 主角采集效率 Max（一击破坏） | - |
| 3 | 工人小屋 Lv1 | 80 | 建造小屋，生成 2名 工人 | - |
| 4 | 防御塔 Lv1 | 150 | 基地中心建造防御塔，单发攻击 | - |
| 5 | 士兵小屋 Lv1 | 250 | 建造小屋，生成 2名 远程士兵 | - |
| 6 | 防御塔 Lv2 | 400 | 升级为加特林，极高射速，射程 60 | 城墙升级为石墙，范围扩大 |
| 7 | 工人小屋 Lv2 | 500 | 额外生成 2名 工人，负重翻倍 | 营地范围扩大 |
| 8 | 士兵小屋 Lv2 | 800 | 额外生成 2名 士兵，伤害翻倍 | 营地范围扩大 |
| 9 | 防御塔 Lv3 | 1500 | 升级为追踪导弹，射程 90 (全屏)，一次发射8枚 | 触发 BOSS 战倒计时 |

---

## 5. 环境与关卡 (Level Design)

### 5.1 动态资源刷新

- **机制**：地图上始终保持约 150 个资源物体
- **分布**：优先在营地半径外围（12~50米）刷新，确保玩家不出门也有资源可采

### 5.2 动态营地

- **围墙**：具有物理碰撞体积，能阻挡敌人移动
- **扩张**：随着 Lv2 建筑的升级，营地半径会自动向外推移（每次 +3 米），围墙模型会重绘

---

## 6. 音效与视觉特效 (Audio & VFX)

### 6.1 程序化音效 (Web Audio API)

无需外部素材，代码实时合成：

**BGM**：管弦乐风格，包含战鼓（Kick）、贝斯（Bass）和随机旋律（Melody），循环播放

**SFX**：

- `Chop`：短促方波（砍树）
- `Laser`：锯齿波+频率滑掠（射击）
- `Explode`：低通滤波白噪音（爆炸）
- `LevelUp`：正弦波爬升（升级）
- `Boss`：低频锯齿波警报（BOSS出现）

### 6.2 视觉特效

- **死亡碎裂**：敌人死亡时分裂成 8-12 个小方块，受重力影响四散掉落并缩小
- **攻击弹道**：不同单位有不同颜色的激光/子弹拖尾（塔=黄/红/紫，士兵=绿）
- **UI 反馈**：伤害飘字、资源获取飘字、血条动态跟随

---

## 7. 界面系统 (UI/UX)

- **新手引导**：开场显示"手指拖动"动画，玩家操作后消失
- **HUD**：左上角显示当前资源总数、当前敌人波次强度
- **世界UI**：3D 场景中跟随光圈的升级提示牌（黑色半透明背景 + 绿色边框）
- **结算画面**：
  - 通关后弹出
  - 包含 Call of Dragons 的 Logo（Emoji/图片）
  - CTA (Call to Action)：黄色"立即下载"按钮（跳转 Google Play）
  - "再战一局"按钮（重置游戏）

---

## 8. 技术细节 (Technical Implementation)

- **渲染循环**：requestAnimationFrame
- **碰撞检测**：基于简单的欧几里得距离计算 (distanceTo)
- **状态机**：
  - 士兵 AI：`Idle -> Chase (Within Range) -> Attack -> Return (Out of Range)`
  - 工人 AI：`Idle -> MoveToResource -> Harvest -> ReturnBase -> Deposit`
- **适配**：window.resize 监听，保证全屏适配
